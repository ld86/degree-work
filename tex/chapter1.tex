\chapter{ОПИСАНИЕ ВЫБОРКИ}

Как говорилось в введении, в качестве объектов исследования будут выступать файлы сложного формата \textbf{.doc}.
Данный формат используется для хранения информации о текстовых, графических документах.
Основным программным продуктом, позволяющим создавать и редактировать файлы формата \textbf{.doc}, является Microsoft Word.
Файлы данного формат имеют бинарную структуру, схожую по строению со структурой файловых систем. \cite{doc_format}

Основной задачей данной работы является описание и построение модели, способной самостоятельно и автоматически определять степень вредоности поступающих к нам извне новых файлов формата \textbf{.doc}.
Для достижения данной цели мы будем использовать комбинацию известных алгоритмов, позволяющих учитывать предыдущий опыт -- так называемых обучаемых алгоритмов.
В нашем случае под опытом стоит понимать наличие двух наборов файлов: множество безопасных для работы документов и множество вредоносных документов.
Объеденение этих двух наборов мы в дальнейшем будем называть выборкой объектов, подразумевая что файлы были выбраны из некоторого нам неизвестного множества всех возможных файлов формата \textbf{.doc}. 
Процесс получения данных наборов называется разметкой, почти всегда данный процесс происходит в ручном режиме.
Тем не менее обычно нас не интересуют каким способом было получено разделение файлов на разные типы, но при этом для нас очень важно, что вероятность ошибочного размещение документа в не подходящем классе была близка к нулю, иначе, основываясь на плохо размеченной выборке объектов, мы можем создать ошибочную модель, допускающую при работе заметное число ошибок.

В отличии от ручного анализа, когда все действия выполняемые программой при работе с документом анализируются человеком, нам для успешного создания работающей модели важно наличие файлов различных типов.
Таким образом, как первый шаг, мы опишем состав нашей выборки объектов, которую в дальнейшем будем использовать в качестве исходных данных для алгоритмов обучения.

\section{Вредоносные файлы}

На данный момент известно огромное множество видов вредоносных программ.
Также существуют различные формальные классификации, позволяющие присвоить метку почти любому вредоносному объекту: от игрушечных программ шуток до целенаправленного высокотехнологичного программного оружия.

Под вредоносной программой принято подразумеваеть файл исполняемого формата, например \textbf{.exe}, при запуске которого управление получает код, выполняющий несанкционированные действия относительно пользователя или владельца компьютера. 
Данный способ, захватывающий поток исполнения, довольно надёжен, но при этом имеет весьма существенный и неустранимый недостаток -- пользователь должен собственоручно начать выполнение кода.
Также такой сценарий захвата через исполняемый файл хорошо изучен в мире, что уменьшает шансы успешного прохождения возможного барьера из современных антивирусов.

В нашем случае предметом исследования являются файлы формата \textbf{.doc}, предназначенные для хранения и отображения текстовой инофморации. 
Ожидаемым поведением при открытии файла такого формата является отображение текста, но никак не запуск произвольного и некотролируемого программного кода.
Данный факт значительно увеличивает количество людей, подверженных атакой через объекты, не связанных напрямую с исполнением программного кода.

Главной причиной, дающей возможность злоумышнику исполнять произвольный код при работе с неисполняемыми объектами, являются ошибки, допущенные при написании исходного кода программ, непосредственно взаимодействующих с такими файлами. 
Для объектов формата \textbf{.doc} такой программой является Microsoft Word.
С момента первого релиза данного текстового процессора были найдены десятки подобных ошибок, чем успешно пользуются многие авторы вирусов.
Одной из такой ошибок является недостаточная или неполная проверка данных, вводимимых пользователем тем или иным способом.
Например, забытая проверка на максимальную длину для введённых строковых данных выливается в размещение данных в блоке памяти, имеющем меньшей размер, чем необходимо. 
Таким образом ввиду особенностей организации хранения служебных данных, злоумышленник получает возможность видоизменять их и в итоге влиять на поток исполнения исходной программы.
Данная техника называется атакой на переполнение буфера и широко применяется в мире.

Работу такого вида вирусов можно разделить на следующие этапы:

\begin{itemize}
\item эксплуатирование ошибки
\item работа промежуточного машинного кода
\item работа основной функциональности вируса
\end{itemize}

В виду ограничений, возникающих во время использования уязвимости, очень редко удаётся выполнить необходимые действия сразу же после перехода на программный код злоумышленника.
Поэтому после эксплуатация ошибки управление получает промежуточный машинный код, именуемый шеллкодом.
Задачей шеллкода является подготовка пользовательского окружения для запуска основной функциональности вируса.
В основном промежуточный код либо производит распаковку дополнительных данных из \textbf{.doc} файла, либо скачивает основную часть функциональности вируса через локальную или глобальную сеть.
Таким образом шеллкод также может предоставлять, модульность работы вредоносного кода, когда работа промежуточного кода и работа основного кода может быть не связана. Более того часто каждый из этих этапов реализован разными людьми.

В итоговой выборке были отобранны файлы, работающие описанным выше образом.
Процесс формирования такого набора объектов занял довольно продолжительное время, так как в основном осуществлялся в ручном режиме.
Также обязательным условием была полная работоспособность файла, содержащего шеллкод, в лабораторных условиях.

\section{Безопасные файлы}

Чтобы построенная модель могла определять степень вредоносности поступающих объектов, ей при построении необходимо в дополнении к информации, полученной по вредоносным файлам, подать на вход данные, собранные по безвредным объектам.
В отличие от вредоносных объектов, безвредные объекты могут быть созданы непосредственно с помощью текстового редактора Microsoft Word.
Так как выборка должна иметь конечный размер, нам необходимо ограничить набор безвредных файлов, которые попадут в исходные данные для обучения.
При этом нам нужно добиться разнообразия среди файлов.

Основной идеей было выделение основных характеристик документа и объединения их значений в различных комбинациях.
В качестве таких характеристик были использованы следующие позиции:
\begin{itemize}
\item количество страниц
\item вариант используемого шрифта
\item наличие таблиц
\item наличие встроенной графики
\item наличие графических изображений
\item использование нестандартных стилей
\item визуальное форматирование текста
\end{itemize}

Такой эвристический подход был выбран в качестве стартового.
Более подробный обзор работы программы Microsoft Word и дальнешая кластеризация действий может увеличить качество разнообразия выборки безопасных файлов, что в итоге может привести к более качественной модели.